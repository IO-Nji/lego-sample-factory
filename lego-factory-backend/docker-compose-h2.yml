version: '3.8'

services:
  user-service:
    image: ${CI_REGISTRY_IMAGE}/backend/user-service:${CI_COMMIT_SHORT_SHA:-latest}
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-default}
      JWT_SECRET: ${JWT_SECRET:-MySecretKeyForJWTTokenGeneration2024AtLeast32Characters}
    ports:
      - "8012:8012"
    networks:
      - lego-backend

  masterdata-service:
    image: ${CI_REGISTRY_IMAGE}/backend/masterdata-service:${CI_COMMIT_SHORT_SHA:-latest}
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-default}
    ports:
      - "8013:8013"
    networks:
      - lego-backend

  inventory-service:
    image: ${CI_REGISTRY_IMAGE}/backend/inventory-service:${CI_COMMIT_SHORT_SHA:-latest}
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-default}
    ports:
      - "8014:8014"
    networks:
      - lego-backend

  order-processing-service:
    image: ${CI_REGISTRY_IMAGE}/backend/order-processing-service:${CI_COMMIT_SHORT_SHA:-latest}
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-default}
    ports:
      - "8015:8015"
    networks:
      - lego-backend

  simal-integration-service:
    image: ${CI_REGISTRY_IMAGE}/backend/simal-integration-service:${CI_COMMIT_SHORT_SHA:-latest}
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-default}
    ports:
      - "8016:8016"
    networks:
      - lego-backend

  api-gateway:
    image: ${CI_REGISTRY_IMAGE}/backend/api-gateway:${CI_COMMIT_SHORT_SHA:-latest}
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-default}
      JWT_SECRET: ${JWT_SECRET:-MySecretKeyForJWTTokenGeneration2024AtLeast32Characters}
    ports:
      - "8011:8011"
    depends_on:
      - user-service
      - masterdata-service
      - inventory-service
      - order-processing-service
      - simal-integration-service
    networks:
      - lego-backend

  frontend:
    image: ${CI_REGISTRY_IMAGE}/frontend:${CI_COMMIT_SHORT_SHA:-latest}
    ports:
      - "5173:80"
    depends_on:
      - api-gateway
    networks:
      - lego-backend

networks:
  lego-backend:
    driver: bridge

# Note: No volumes needed since all services use H2 in-memory databases
# This simplifies deployment and eliminates external database dependencies