# ================================================
# Cloud-Native Profile Configuration
# ================================================
# For AWS ECS, Azure Container Apps, GCP Cloud Run
# Activate with: SPRING_PROFILES_ACTIVE=cloud

# Production thresholds (can be overridden via ConfigMap/Secrets)
life.order-processing.thresholds.lot-size-threshold=${LOT_SIZE_THRESHOLD:10}
life.order-processing.thresholds.max-order-items=${MAX_ORDER_ITEMS:100}
life.order-processing.thresholds.stock-reserve-minutes=${STOCK_RESERVE_MINUTES:15}
life.order-processing.thresholds.max-retries=${MAX_RETRIES:5}

# Cloud-optimized timeouts (lower latency expected)
life.order-processing.timeouts.masterdata-read-ms=${MASTERDATA_READ_TIMEOUT:2000}
life.order-processing.timeouts.inventory-read-ms=${INVENTORY_READ_TIMEOUT:1500}
life.order-processing.timeouts.inventory-write-ms=${INVENTORY_WRITE_TIMEOUT:3000}
life.order-processing.timeouts.simal-schedule-ms=${SIMAL_SCHEDULE_TIMEOUT:15000}
life.order-processing.timeouts.user-service-ms=${USER_SERVICE_TIMEOUT:1500}

# Cloud feature flags - enable resilience features
life.order-processing.features.enable-caching=${ENABLE_CACHING:true}
life.order-processing.features.enable-circuit-breaker=${ENABLE_CIRCUIT_BREAKER:true}
life.order-processing.features.enable-async-processing=${ENABLE_ASYNC:true}
life.order-processing.features.enable-metrics=${ENABLE_METRICS:true}
life.order-processing.features.enable-detailed-logging=${ENABLE_DETAILED_LOGGING:false}

# ================================================
# External Service URLs (from environment)
# ================================================
masterdata.service.url=${MASTERDATA_SERVICE_URL:http://masterdata-service:8013}
inventory.service.url=${INVENTORY_SERVICE_URL:http://inventory-service:8014}
simal.service.url=${SIMAL_SERVICE_URL:http://simal-integration-service:8016}
user.service.url=${USER_SERVICE_URL:http://user-service:8012}

# ================================================
# Database Configuration (Cloud-managed)
# ================================================
# AWS RDS, Azure SQL, GCP Cloud SQL
spring.datasource.url=${DATABASE_URL}
spring.datasource.username=${DATABASE_USERNAME}
spring.datasource.password=${DATABASE_PASSWORD}
spring.datasource.driver-class-name=${DATABASE_DRIVER:org.postgresql.Driver}
spring.jpa.database-platform=${JPA_DIALECT:org.hibernate.dialect.PostgreSQLDialect}
spring.jpa.hibernate.ddl-auto=validate

# Connection pooling (HikariCP)
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:10}
spring.datasource.hikari.minimum-idle=${DB_MIN_IDLE:2}
spring.datasource.hikari.connection-timeout=${DB_CONNECT_TIMEOUT:30000}
spring.datasource.hikari.idle-timeout=${DB_IDLE_TIMEOUT:600000}

# ================================================
# Caching (Redis/ElastiCache/Azure Cache)
# ================================================
spring.cache.type=${CACHE_TYPE:redis}
spring.data.redis.host=${REDIS_HOST:localhost}
spring.data.redis.port=${REDIS_PORT:6379}
spring.data.redis.password=${REDIS_PASSWORD:}
spring.data.redis.ssl.enabled=${REDIS_SSL:false}
spring.data.redis.timeout=${REDIS_TIMEOUT:2000}

# ================================================
# Observability (CloudWatch, Azure Monitor, Cloud Logging)
# ================================================
management.endpoints.web.exposure.include=health,info,metrics,prometheus
management.metrics.export.prometheus.enabled=true
management.endpoint.health.show-details=when_authorized
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true

# Distributed tracing
spring.sleuth.enabled=${ENABLE_TRACING:true}
spring.zipkin.base-url=${ZIPKIN_URL:http://zipkin:9411}

# ================================================
# Security (Cloud IAM integration)
# ================================================
# JWT validation endpoint (for OAuth2/OIDC)
spring.security.oauth2.resourceserver.jwt.issuer-uri=${JWT_ISSUER_URI:}

# ================================================
# Logging (JSON format for cloud log aggregation)
# ================================================
logging.level.io.life=INFO
logging.level.root=WARN
logging.pattern.console=${CLOUD_LOG_PATTERN:%d{yyyy-MM-dd HH:mm:ss.SSS} %-5level [%thread] %logger{36} - %msg%n}

# Disable H2 Console in cloud
spring.h2.console.enabled=false
spring.jpa.show-sql=false
spring.jpa.open-in-view=false
